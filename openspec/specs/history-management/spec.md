# history-management Specification

## Purpose
TBD - created by archiving change implement-coffee-roast-detection. Update Purpose after archive.
## Requirements
### Requirement: 检测结果保存
系统 SHALL 将每次检测的结果保存到本地存储，包括时间戳、Agtron值、Lab值和烘焙度描述。

#### Scenario: 保存检测结果
- **WHEN** 用户完成检测并点击"保存结果"
- **THEN** 系统将以下信息保存到本地存储：
  - 检测时间（时间戳或格式化字符串）
  - Agtron值
  - 平均L*、a*、b*值
  - 烘焙度描述
  - 颜色细分描述
- **AND** 系统为每条记录生成唯一标识符
- **AND** 系统提示用户保存成功

### Requirement: 历史记录列表
系统 SHALL 提供历史记录列表功能，显示所有已保存的检测记录。

#### Scenario: 查看历史记录
- **WHEN** 用户进入历史记录页面或点击查看历史按钮
- **THEN** 系统从本地存储读取所有历史记录
- **AND** 系统按时间倒序显示记录列表
- **AND** 每条记录显示：检测时间（日期和时间）、Agtron值、烘焙度描述、颜色描述、L*值
- **AND** 系统显示记录总数（如"共X条"）

#### Scenario: 历史记录为空
- **WHEN** 用户查看历史记录但本地存储中没有记录
- **THEN** 系统显示"暂无历史记录"提示
- **AND** 系统显示空状态提示信息（"还没有检测记录"和"完成检测后点击'保存结果'即可保存"）

### Requirement: 历史记录详情
系统 SHALL 支持查看单条历史记录的详细信息。

#### Scenario: 查看记录详情
- **WHEN** 用户点击历史记录列表中的某条记录
- **THEN** 系统显示该记录的完整信息（通过模态框）：
  - Agtron值
  - 烘焙度描述和颜色细分
  - L*值
  - 5个采样点的Lab值（L*, a*, b*）

### Requirement: 历史记录删除
系统 SHALL 支持删除单条或全部历史记录。

#### Scenario: 删除单条记录
- **WHEN** 用户在历史记录列表中点击删除按钮
- **THEN** 系统提示用户确认删除
- **AND** 用户确认后，系统从本地存储中删除该记录
- **AND** 系统更新历史记录列表显示

#### Scenario: 清空所有记录
- **WHEN** 用户点击"清空所有记录"按钮
- **THEN** 系统提示用户确认操作
- **AND** 用户确认后，系统清空所有历史记录
- **AND** 系统显示"暂无历史记录"提示

### Requirement: 存储空间管理
系统 SHALL 管理本地存储空间，确保不超过微信小程序10MB限制。

#### Scenario: 存储空间检查
- **WHEN** 系统保存新的检测结果
- **THEN** 系统检查历史记录数量
- **AND** 如果记录数量超过100条，系统自动删除最旧的记录
- **AND** 系统在历史记录页面底部显示提示："最多保存100条记录，超出后自动删除最早的记录"

### Requirement: 历史记录导出
系统 SHALL 支持将历史记录导出到剪贴板。

#### Scenario: 导出历史记录
- **WHEN** 用户在历史记录页面点击"导出"按钮
- **THEN** 系统将历史记录数据（JSON格式）复制到剪贴板
- **AND** 系统提示用户"已复制到剪贴板"
- **AND** 如果历史记录为空，系统提示"暂无记录"

