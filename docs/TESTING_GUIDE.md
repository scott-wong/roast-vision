# 咖啡烘焙度检测功能测试指南

## 前置条件

1. ✅ 安装微信开发者工具
2. ✅ 导入项目到微信开发者工具
3. ✅ 准备测试图片(位于`docs/testcases/`目录)

## 测试步骤

### 第一步: 启动项目

1. 打开微信开发者工具
2. 导入项目: `/Users/scott/Documents/scott/roast-vision`
3. 确认项目正常编译,没有错误
4. 点击"编译"按钮

### 第二步: 运行单元测试

在微信开发者工具的控制台中运行以下代码:

```javascript
// 运行所有测试
const { runAllTests } = require('./utils/run-tests');
runAllTests();
```

**预期结果**:
- RGB→Lab转换测试: 7/7 通过 ✅
- Agtron计算测试: 6/6 通过 ✅
- 多点采样测试: 3/3 通过 ✅

### 第三步: 测试图片选择功能

#### 测试3.1: 拍照功能
1. 在小程序主页点击"拍照"按钮
2. 在模拟器中选择一张图片(或在真机上拍照)
3. 确认图片正确显示在页面上
4. 确认Canvas已初始化(无错误提示)

**验证点**:
- ✅ 图片正确加载和显示
- ✅ Canvas隐藏但已初始化
- ✅ 采样点数显示为 (0/5)

#### 测试3.2: 相册选择功能
1. 点击"从相册选择"按钮
2. 选择`docs/testcases/梨桃花2.0中浅烘.jpg`
3. 确认图片正确显示

**验证点**:
- ✅ 图片加载成功
- ✅ 图片尺寸适配正确

### 第四步: 测试采样点选择

使用图片: `梨桃花2.0中浅烘.jpg`

1. 在咖啡豆表面点击5次,选择采样点
   - 建议选择颜色均匀的区域
   - 避免高光和阴影
   - 分散在不同的咖啡豆上

2. 观察采样点标记
   - 每个点应显示为绿色圆圈
   - 编号1-5清晰可见
   - 位置准确(点击位置)

3. 测试删除功能
   - 点击任意采样点标记
   - 确认该点被删除
   - 重新选择该点

**验证点**:
- ✅ 采样点标记显示正确
- ✅ 采样点数量正确(最多5个)
- ✅ 删除功能正常
- ✅ 达到5个点时显示"已选择5个采样点"提示

### 第五步: 测试结果计算

1. 选择完5个采样点后,点击"计算烘焙度"按钮

2. 查看检测结果:
   - Agtron值
   - 烘焙度级别
   - 颜色描述
   - 平均L*值
   - 5个采样点的详细Lab值

**验证点**:
- ✅ 计算立即完成(< 100ms)
- ✅ Agtron值在合理范围(25-100)
- ✅ 烘焙度描述正确
- ✅ Lab值显示完整

**预期结果** (梨桃花2.0中浅烘):
- 烘焙度: 浅烘或中烘
- Agtron值: 约80-90
- L*值: 约28-38

### 第六步: 测试历史记录保存

1. 点击"保存结果"按钮
2. 确认显示"保存成功"提示

3. 在控制台验证存储:
```javascript
// 查看历史记录
const history = wx.getStorageSync('roastHistory');
console.log('历史记录:', JSON.parse(history));
```

**验证点**:
- ✅ 保存成功提示
- ✅ 数据正确保存到本地存储
- ✅ 数据结构完整(id, timestamp, agtron, roastLevel, 等)

### 第七步: 测试重新检测

1. 点击"重新检测"按钮
2. 确认弹出确认对话框
3. 点击"确定"

**验证点**:
- ✅ 采样点清空
- ✅ 结果清空
- ✅ 图片保留
- ✅ 可以重新选择采样点

### 第八步: 多图片测试

对每张测试图片重复步骤3-7:

#### 测试图片1: 梨桃花2.0中浅烘.jpg
- 描述: 中浅烘咖啡豆
- 预期烘焙度: 浅烘/中烘
- 预期Agtron: 80-90
- 记录实际结果: __________

#### 测试图片2: 微信图片_20251220142638_107_130.jpg
- 描述: 待测咖啡豆
- 预期烘焙度: 待确认
- 预期Agtron: 待确认
- 记录实际结果: __________

### 第九步: 边界条件测试

#### 测试9.1: 选择非咖啡豆图片
1. 选择一张纯白色或纯黑色图片
2. 选择5个采样点
3. 计算结果

**验证点**:
- ✅ 白色图片: Agtron=100, 白色烘焙
- ✅ 黑色图片: Agtron=25, 超深烘

#### 测试9.2: 极端不均匀采样
1. 选择同一张图片
2. 5个采样点分别选择: 高光区、正常区、阴影区、边缘、中心
3. 观察结果的合理性

**验证点**:
- ✅ 程序不崩溃
- ✅ 结果在合理范围
- ✅ 提示用户采样点差异较大(如果实现)

### 第十步: 性能测试

1. 测试大图片(> 2MB)
   - 加载时间: < 2秒
   - Canvas处理时间: < 500ms
   - 采样点响应: 立即

2. 测试快速连续操作
   - 快速点击5个采样点
   - 立即计算
   - 立即保存
   - 立即重新开始

**验证点**:
- ✅ 无卡顿
- ✅ 无崩溃
- ✅ 数据正确

## 测试结果记录表

### 功能测试

| 功能模块 | 测试项 | 状态 | 备注 |
|---------|--------|------|------|
| 图片选择 | 拍照功能 | ☐ 通过 ☐ 失败 | |
| 图片选择 | 相册选择 | ☐ 通过 ☐ 失败 | |
| Canvas处理 | 图片绘制 | ☐ 通过 ☐ 失败 | |
| 采样点选择 | 点击选择 | ☐ 通过 ☐ 失败 | |
| 采样点选择 | 标记显示 | ☐ 通过 ☐ 失败 | |
| 采样点选择 | 删除功能 | ☐ 通过 ☐ 失败 | |
| 颜色提取 | RGB值提取 | ☐ 通过 ☐ 失败 | |
| 颜色转换 | Lab值计算 | ☐ 通过 ☐ 失败 | |
| 结果计算 | Agtron计算 | ☐ 通过 ☐ 失败 | |
| 结果显示 | 结果卡片 | ☐ 通过 ☐ 失败 | |
| 历史记录 | 保存功能 | ☐ 通过 ☐ 失败 | |
| 重新检测 | 清除功能 | ☐ 通过 ☐ 失败 | |

### 真实图片测试记录

#### 图片1: 梨桃花2.0中浅烘.jpg

采样点Lab值:
```
点1: L*=_____, a*=_____, b*=_____
点2: L*=_____, a*=_____, b*=_____
点3: L*=_____, a*=_____, b*=_____
点4: L*=_____, a*=_____, b*=_____
点5: L*=_____, a*=_____, b*=_____
```

检测结果:
- 平均L*: _____
- Agtron值: _____
- 烘焙度: _____
- 颜色描述: _____

评估:
- ☐ 结果准确
- ☐ 结果基本准确
- ☐ 结果不准确

备注: _____________________________

#### 图片2: 微信图片_20251220142638_107_130.jpg

采样点Lab值:
```
点1: L*=_____, a*=_____, b*=_____
点2: L*=_____, a*=_____, b*=_____
点3: L*=_____, a*=_____, b*=_____
点4: L*=_____, a*=_____, b*=_____
点5: L*=_____, a*=_____, b*=_____
```

检测结果:
- 平均L*: _____
- Agtron值: _____
- 烘焙度: _____
- 颜色描述: _____

评估:
- ☐ 结果准确
- ☐ 结果基本准确
- ☐ 结果不准确

备注: _____________________________

## 问题记录

如果在测试过程中发现问题,请记录:

### 问题1
- **描述**: _____________________________
- **重现步骤**: _____________________________
- **预期结果**: _____________________________
- **实际结果**: _____________________________
- **严重程度**: ☐ 高 ☐ 中 ☐ 低

### 问题2
- **描述**: _____________________________
- **重现步骤**: _____________________________
- **预期结果**: _____________________________
- **实际结果**: _____________________________
- **严重程度**: ☐ 高 ☐ 中 ☐ 低

## 测试完成检查表

- ☐ 所有单元测试通过
- ☐ 所有功能测试通过
- ☐ 至少测试2张真实咖啡豆图片
- ☐ 性能测试通过
- ☐ 边界条件测试通过
- ☐ 无严重问题
- ☐ 测试结果已记录

## 测试结论

**测试日期**: _____________________________
**测试人员**: _____________________________
**测试结果**: ☐ 通过 ☐ 部分通过 ☐ 失败
**总体评价**: _____________________________

---

## 附录: 控制台测试命令

### 查看历史记录
```javascript
const history = wx.getStorageSync('roastHistory');
console.log('历史记录:', JSON.parse(history || '[]'));
```

### 清空历史记录
```javascript
wx.removeStorageSync('roastHistory');
console.log('历史记录已清空');
```

### 测试RGB→Lab转换
```javascript
const { rgbToLab } = require('./utils/color-converter');
const lab = rgbToLab({ r: 150, g: 100, b: 70 });
console.log('Lab值:', lab);
```

### 测试Agtron计算
```javascript
const { calculateAgtron } = require('./utils/agtron-calculator');
const result = calculateAgtron(23.4);
console.log('Agtron结果:', result);
```

### 运行完整测试套件
```javascript
const { runAllTests } = require('./utils/run-tests');
runAllTests();
```

### 快速验证测试
```javascript
const { runQuickTests } = require('./utils/run-tests');
runQuickTests();
```

